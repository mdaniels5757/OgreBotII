(function(){var d=d||{};d.scope={};d.ASSUME_ES5=!1;d.ASSUME_NO_NATIVE_MAP=!1;d.ASSUME_NO_NATIVE_SET=!1;d.defineProperty=d.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};d.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};d.global=d.getGlobal(this);d.SYMBOL_PREFIX="jscomp_symbol_";
d.initSymbol=function(){d.initSymbol=function(){};d.global.Symbol||(d.global.Symbol=d.Symbol)};d.Symbol=function(){var a=0;return function(b){return d.SYMBOL_PREFIX+(b||"")+a++}}();d.initSymbolIterator=function(){d.initSymbol();var a=d.global.Symbol.iterator;a||(a=d.global.Symbol.iterator=d.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&d.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return d.arrayIterator(this)}});d.initSymbolIterator=function(){}};
d.arrayIterator=function(a){var b=0;return d.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};d.iteratorPrototype=function(a){d.initSymbolIterator();a={next:a};a[d.global.Symbol.iterator]=function(){return this};return a};d.makeIterator=function(a){d.initSymbolIterator();d.initSymbol();d.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):d.arrayIterator(a)};
d.polyfill=function(a,b){if(b){var c=d.global;a=a.split(".");for(var e=0;e<a.length-1;e++){var g=a[e];g in c||(c[g]={});c=c[g]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&d.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};d.FORCE_POLYFILL_PROMISE=!1;
d.polyfill("Promise",function(a){function b(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var h=this.createResolveAndReject_();try{a(h.resolve,h.reject)}catch(k){h.reject(k)}}function c(){this.batch_=null}function e(a){return a instanceof b?a:new b(function(h){h(a)})}if(a&&!d.FORCE_POLYFILL_PROMISE)return a;c.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};c.prototype.asyncExecuteBatch_=function(){var a=
this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var g=d.global.setTimeout;c.prototype.asyncExecuteFunction=function(a){g(a,0)};c.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};c.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};b.prototype.createResolveAndReject_=function(){function a(a){return function(h){c||
(c=!0,a.call(b,h))}}var b=this,c=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};b.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof b)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var c=null!=a;break a;case "function":c=!0;break a;default:c=!1}c?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};b.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(k){this.reject_(k);
return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};b.prototype.reject_=function(a){this.settle_(2,a)};b.prototype.fulfill_=function(a){this.settle_(1,a)};b.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};b.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=this.onSettledCallbacks_,
b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var f=new c;b.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};b.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(l){c.reject(l)}};b.prototype.then=function(a,c){function e(a,b){return"function"==typeof a?function(b){try{f(a(b))}catch(L){g(L)}}:b}var f,g,h=new b(function(a,b){f=a;g=b});
this.callWhenSettled_(e(a,f),e(c,g));return h};b.prototype.catch=function(a){return this.then(void 0,a)};b.prototype.callWhenSettled_=function(a,b){function c(){switch(e.state_){case 1:a(e.result_);break;case 2:b(e.result_);break;default:throw Error("Unexpected state: "+e.state_);}}var e=this;null==this.onSettledCallbacks_?f.asyncExecute(c):this.onSettledCallbacks_.push(function(){f.asyncExecute(c)})};b.resolve=e;b.reject=function(a){return new b(function(b,c){c(a)})};b.race=function(a){return new b(function(b,
c){for(var f=d.makeIterator(a),g=f.next();!g.done;g=f.next())e(g.value).callWhenSettled_(b,c)})};b.all=function(a){var c=d.makeIterator(a),f=c.next();return f.done?e([]):new b(function(a,b){function g(b){return function(c){h[b]=c;k--;0==k&&a(h)}}var h=[],k=0;do h.push(void 0),k++,e(f.value).callWhenSettled_(g(h.length-1),b),f=c.next();while(!f.done)})};return b},"es6","es3");
d.executeAsyncGenerator=function(a){function b(b){return a.next(b)}function c(b){return a.throw(b)}return new Promise(function(e,g){function f(a){a.done?e(a.value):Promise.resolve(a.value).then(b,c).then(f,g)}f(a.next())})};d.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var e=a.length,g=0;g<e;g++){var f=a[g];if(b.call(c,f,g,a))return{i:g,v:f}}return{i:-1,v:void 0}};
d.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return d.findInternal(this,a,c).v}},"es6","es3");var q=$("#request_key").val(),r=$(".panel"),t=$("#next"),u=$("#previous"),v=$("#submit"),w=$("[name='type']"),x=$("#start-form"),y=$("#phase"),z=$(".newuser-instructions"),A=$("#save-state"),B=$(".all-map-links"),C=$("#all-map-links-toggle"),D=JSON.stringify.bind(JSON),E=$(".body-wrapper"),F=$.noop,G=F;function H(){window.alert("Er, that didn't seem to work.")}
function I(a){a=+y.val()+a;var b=a===r.length-1,c=w.filter(":checked").val(),e=c?$("#branch-"+c):0;y.val(a);r.hide().eq(a).show();u.add(A).toggle(0!==a);t.toggle(!b);v.toggle(b);c&&($(".branch-div").hide(),e.show().closest(".panel"))}function J(){z.dialog({modal:!0,width:800,buttons:{OK:function(){$(this).dialog("close")}},close:function(){localStorage.setItem("magog.branchmapper.returnuser",Date.now())}})}
function M(a){a=a?$.parseJSON(a):{};if(!$.isPlainObject(a))throw"Deserialization failed!";return window.sortByKey(a)}x.submit(function(){if(!v.is(":visible"))return!1;E.spinner();$(":submit").attr("disabled","disabled")});I(0);u.click($.proxy(I,u,-1));t.click($.proxy(I,u,1)).attr("disabled",w.filter(":checked")[0]?null:"disabled");w.one("change",$.fn.attr.bind(t,"disabled",null));
$(".download-button").click(function(){var a=$(this),b=a.closest("[data-map-name]"),c=b.data("mapName"),e=$(".svg-options");G=function(){return d.executeAsyncGenerator(function(){function g(g,n,K){for(;;)switch(f){case 0:l=a.closest("tr").children(".map,.selection,.resolution").spinner();e.dialog("close");try{return f=5,{value:$.fileDownload("download.php",{cookieName:"branchmapper-"+q+"-"+c,cookiePath:$("#cookie-path").val(),checkInterval:1E3,data:{request_key:q,map:c,color:$("#option-color").val(),
radius:$("#option-radius").val()},httpMethod:"post",failMessageHtml:"Unable to download "+b.data("mapHumanReadable")+". Please reload the page and try again."}),done:!1}}catch(m){k=m;f=1;break}case 5:try{if(1!=g){f=6;break}p=4;f=2;break}catch(m){k=m;f=1;break}case 4:try{throw f=-1,K;}catch(m){k=m;f=1;break}case 6:try{p=3;f=2;break}catch(m){k=m;f=1;break}case 1:throw h=k,f=-1,h;case 2:l.spinner("remove");f=p;break;case 3:f=-1;default:return{value:void 0,done:!0}}}var f=0,h,p,k,l,n={next:function(a){return g(0,
a,void 0)},throw:function(a){return g(1,void 0,a)},return:function(){throw Error("Not yet implemented");}};d.initSymbolIterator();n[Symbol.iterator]=function(){return this};return n}())};e.dialog({close:function(){G=F},modal:!0,width:600,height:400});$("#recommended-dimensions").html(""+b.data("mapRecommendedWidth")+("&nbsp;\u00d7&nbsp;"+b.data("mapRecommendedHeight")))});$(".resolution :checkbox").click(function(){var a=$(this);a.siblings(":text").toggle(!a.is(":checked"))});
$(".show-wikitext").click(function(a){var b=this;return d.executeAsyncGenerator(function(){function c(c,g,p){for(;;)switch(e){case 0:return a.preventDefault(),e=1,{value:$(b).closest(".wikitext").find(".wikitext-toggle").each(function(){var a=$(this);a.slideToggle(a.height())}).promise(),done:!1};case 1:if(1!=c){e=2;break}e=-1;throw p;case 2:$.spinner.all.redraw(),e=-1;default:return{value:void 0,done:!0}}}var e=0,g={next:function(a){return c(0,a,void 0)},throw:function(a){return c(1,void 0,a)},return:function(){throw Error("Not yet implemented");
}};d.initSymbolIterator();g[Symbol.iterator]=function(){return this};return g}())});
$("#verify-input").click(function(){return d.executeAsyncGenerator(function(){function a(a,h,l){for(;;)switch(b){case 0:E.spinner();try{return b=4,{value:$.ajax("check.php",{data:x.serialize(),method:"post"}),done:!1}}catch(n){b=1;break}case 4:try{if(1!=a){b=5;break}b=-1;throw l;}catch(n){b=1;break}case 5:try{(c=(e=g=h)&&e.message)?$("#verify-text").val(c):window.alert(e&&e.error||"Connection problem or server error.");f=3;b=2;break}catch(n){b=1;break}case 1:window.alert("Connection problem"),f=3;
case 2:E.spinner("remove");b=f;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,c,e,g,f,h={next:function(b){return a(0,b,void 0)},throw:function(b){return a(1,void 0,b)},return:function(){throw Error("Not yet implemented");}};d.initSymbolIterator();h[Symbol.iterator]=function(){return this};return h}())});$("#final-download").click(function(){G()});(localStorage.getItem("magog.branchmapper.returnuser")||0)<Date.now()-2592E6&&J();
$("#click-help").click(function(){J();setTimeout($.fn.closeTooltip.bind($(this)),1)});
$("#load-state").click(function(){var a=$("<div/>"),b=$("<table class='load-session'/>").clone().show(),c=M(localStorage.getItem("magog.branchmapper.savestate"));$.each(c,function(e,g){var f=$("<input type='button' value='Load'  class='btn btn-primary' />").click(function(){w.filter("[value='"+g.type+"']").prop("checked",!0);$.each(g.inputs,function(a,b){$("textarea[name='"+a+"']").val(b)});y.val(1);I(0);a.dialog("close")}),h=$("<input type='button' value='Remove' class='btn btn-warning' />").click(function(){h.closest("tr").remove();
delete c[e];localStorage.setItem("magog.branchmapper.savestate",D(c))});b.append($("<tr/>").append($("<td/>").append(f)).append($("<td/>").append(h)).append($("<td/>").text(e)))});a.append(b).dialog({modal:!0,width:800,title:"Select a session",buttons:{Cancel:function(){$(this).dialog("close")}}})});
A.click(function(){for(var a=w.filter(":checked").val(),b=$("#branch-"+a+" textarea"),c=M(localStorage.getItem("magog.branchmapper.savestate")),e=0,g,f;c["Saved "+ ++e];);do{g=prompt("Name of the saved state: ","Saved "+e);if(null===g)return;c[g]&&window.confirm("The name already exists. Overwrite?")&&(c[g]=0)}while(c[g]);f={type:a,inputs:{}};b.each(function(){var a=$(this);f.inputs[a.attr("name")]=a.val()});c[g]=f;localStorage.setItem("magog.branchmapper.savestate",D(c))});
$("#import").fileReader({error:H,load:function(){try{var a=0,b=this.result,c=M(localStorage.getItem("magog.branchmapper.savestate"));$.each(M(b),function(b,g){var f=g.inputs,e=!0;$.isPlainObject(f)&&($.each(f,function(a,b){return e="string"===typeof b}),e&&(f=c[b],f&&D(f)===D(g)&&window.confirm("Overwrite "+b+"?")||(a++,c[b]=g)))});localStorage.setItem("magog.branchmapper.savestate",D(c));window.alert(a+" entries loaded.")}catch(e){H()}}});
$("#export").click(function(){saveAs(new Blob([localStorage.getItem("magog.branchmapper.savestate")],{type:"text/plain;charset=utf-8"}),"branchmapper-data.txt")});
C.click(function(a){return d.executeAsyncGenerator(function(){function b(b,e,h){for(;;)switch(c){case 0:return a.preventDefault(),c=1,{value:B.slideToggle(50).promise(),done:!1};case 1:if(1!=b){c=2;break}c=-1;throw h;case 2:C.text(B.is(":hidden")?"+":"-"),c=-1;default:return{value:void 0,done:!0}}}var c=0,e={next:function(a){return b(0,a,void 0)},throw:function(a){return b(1,void 0,a)},return:function(){throw Error("Not yet implemented");}};d.initSymbolIterator();e[Symbol.iterator]=function(){return this};
return e}())});}).call(this);

//# sourceMappingURL=js/branchmapper.js.map
