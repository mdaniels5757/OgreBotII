var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.polyfill=function(a,b,d,e){if(b){d=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var c=a[e];c in d||(d[c]={});d=d[c]}a=a[a.length-1];e=d[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function d(a){return a instanceof c?a:new c(function(b,g){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var e=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){e(a,
0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var c=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(h){b.reject(h)}};c.prototype.createResolveAndReject_=
function(){function a(a){return function(g){c||(c=!0,a.call(b,g))}}var b=this,c=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};c.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof c)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};c.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(h){this.reject_(h);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};c.prototype.reject_=function(a){this.settle_(2,a)};c.prototype.fulfill_=function(a){this.settle_(1,a)};c.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};c.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var f=new b;c.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};c.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(l){c.reject(l)}};c.prototype.then=function(a,b){function d(a,b){return"function"==typeof a?function(b){try{e(a(b))}catch(p){g(p)}}:b}var e,g,f=new c(function(a,
b){e=a;g=b});this.callWhenSettled_(d(a,e),d(b,g));return f};c.prototype.catch=function(a){return this.then(void 0,a)};c.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?f.asyncExecute(c):this.onSettledCallbacks_.push(function(){f.asyncExecute(c)})};c.resolve=d;c.reject=function(a){return new c(function(b,c){c(a)})};c.race=function(a){return new c(function(b,
c){for(var e=$jscomp.makeIterator(a),g=e.next();!g.done;g=e.next())d(g.value).callWhenSettled_(b,c)})};c.all=function(a){var b=$jscomp.makeIterator(a),e=b.next();return e.done?d([]):new c(function(a,c){function g(b){return function(c){f[b]=c;h--;0==h&&a(f)}}var f=[],h=0;do f.push(void 0),h++,d(e.value).callWhenSettled_(g(f.length-1),c),e=b.next();while(!e.done)})};return c},"es6","es3");
$jscomp.asyncExecutePromiseGenerator=function(a){function b(b){return a.next(b)}function d(b){return a.throw(b)}return new Promise(function(e,c){function f(a){a.done?e(a.value):Promise.resolve(a.value).then(b,d).then(f,c)}f(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};
$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};
$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var d=a.next();$jscomp.generator.ensureIteratorResultIsObject_(d);if(d.done)this.yieldResult=d.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(d.value,b)};$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,d){d?this.finallyContexts_[d]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(a){return{value:a,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,d){try{var e=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(e);if(!e.done)return this.context_.stop_(),e;var c=e.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;d.call(this.context_,c);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){$jscomp.generator.Generator_.prototype=a.prototype;return new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b))};
$jscomp.findInternal=function(a,b,d){a instanceof String&&(a=String(a));for(var e=a.length,c=0;c<e;c++){var f=a[c];if(b.call(d,f,c,a))return{i:c,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");
(function(a){function b(){a.alert("Er, that didn't seem to work.")}function d(a){a=+r.val()+a;var b=a===g.length-1,c=m.filter(":checked").val(),d=c?$("#branch-"+c):0;r.val(a);g.hide().eq(a).show();h.add(v).toggle(0!==a);q.toggle(!b);l.toggle(b);c&&($(".branch-div").hide(),d.show().closest(".panel"))}function e(){B.dialog({modal:!0,width:800,buttons:{OK:function(){$(this).dialog("close")}},close:function(){localStorage.setItem("magog.branchmapper.returnuser",Date.now())}})}function c(b){b=b?$.parseJSON(b):
{};if(!$.isPlainObject(b))throw"Deserialization failed!";return a.sortByKey(b)}var f=$("#request_key").val(),g=$(".panel"),q=$("#next"),h=$("#previous"),l=$("#submit"),m=$("[name='type']"),w=$("#start-form"),r=$("#phase"),B=$(".newuser-instructions"),v=$("#save-state"),p=$(".all-map-links"),y=$("#all-map-links-toggle"),z=a.JSON,n=z.stringify.bind(z),t=$(".body-wrapper"),A=$.noop,u=A;w.submit(function(){if(!l.is(":visible"))return!1;t.spinner();$(":submit").attr("disabled","disabled")});d(0);h.click($.proxy(d,
h,-1));q.click($.proxy(d,h,1)).attr("disabled",m.filter(":checked")[0]?null:"disabled");m.one("change",$.fn.attr.bind(q,"disabled",null));$(".download-button").click(function(){var a=$(this),b=a.closest("[data-map-name]"),c=b.data("mapName"),d=$(".svg-options");u=function(){return $jscomp.asyncExecutePromiseGeneratorFunction(function D(){var e;return $jscomp.generator.createGenerator(D,function(k){switch(k.nextAddress){case 1:return e=a.closest("tr").children(".map,.selection,.resolution").spinner(),
d.dialog("close"),k.setFinallyBlock(2),k.yield($.fileDownload("download.php",{cookieName:"branchmapper-"+f+"-"+c,cookiePath:$("#cookie-path").val(),checkInterval:1E3,data:{request_key:f,map:c,color:$("#option-color").val(),radius:$("#option-radius").val()},httpMethod:"post",failMessageHtml:"Unable to download "+b.data("mapHumanReadable")+". Please reload the page and try again."}),2);case 2:k.enterFinallyBlock(),e.spinner("remove"),k.leaveFinallyBlock(0)}})})};d.dialog({close:function(){u=A},modal:!0,
width:600,height:400});$("#recommended-dimensions").html(""+b.data("mapRecommendedWidth")+("&nbsp;\u00d7&nbsp;"+b.data("mapRecommendedHeight")))});$(".resolution :checkbox").click(function(){var a=$(this);a.siblings(":text").toggle(!a.is(":checked"))});$(".show-wikitext").click(function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function x(){return $jscomp.generator.createGenerator(x,function(c){switch(c.nextAddress){case 1:return a.preventDefault(),c.yield($(b).closest(".wikitext").find(".wikitext-toggle").each(function(){var a=
$(this);a.slideToggle(a.height())}).promise(),2);case 2:$.spinner.all.redraw(),c.jumpToEnd()}})})});$("#verify-input").click(function(){return $jscomp.asyncExecutePromiseGeneratorFunction(function C(){var b,c;return $jscomp.generator.createGenerator(C,function(d){switch(d.nextAddress){case 1:return t.spinner(),d.setCatchFinallyBlocks(2,3),d.yield($.ajax("check.php",{data:w.serialize(),method:"post"}),5);case 5:(c=(b=d.yieldResult)&&b.message)?$("#verify-text").val(c):a.alert(b&&b.error||"Connection problem or server error.");
case 3:d.enterFinallyBlock();t.spinner("remove");d.leaveFinallyBlock(0);break;case 2:d.enterCatchBlock(),a.alert("Connection problem"),d.jumpTo(3)}})})});$("#final-download").click(function(){u()});(localStorage.getItem("magog.branchmapper.returnuser")||0)<Date.now()-2592E6&&e();$("#click-help").click(function(){e();setTimeout($.fn.closeTooltip.bind($(this)),1)});$("#load-state").click(function(){var a=$("<div/>"),b=$("<table class='load-session'/>").clone().show(),e=c(localStorage.getItem("magog.branchmapper.savestate"));
$.each(e,function(c,f){var k=$("<input type='button' value='Load'  class='btn btn-primary' />").click(function(){m.filter("[value='"+f.type+"']").prop("checked",!0);$.each(f.inputs,function(a,b){$("textarea[name='"+a+"']").val(b)});r.val(1);d(0);a.dialog("close")}),g=$("<input type='button' value='Remove' class='btn btn-warning' />").click(function(){g.closest("tr").remove();delete e[c];localStorage.setItem("magog.branchmapper.savestate",n(e))});b.append($("<tr/>").append($("<td/>").append(k)).append($("<td/>").append(g)).append($("<td/>").text(c)))});
a.append(b).dialog({modal:!0,width:800,title:"Select a session",buttons:{Cancel:function(){$(this).dialog("close")}}})});v.click(function(){for(var b=m.filter(":checked").val(),d=$("#branch-"+b+" textarea"),e=c(localStorage.getItem("magog.branchmapper.savestate")),f=0,g,h;e["Saved "+ ++f];);do{g=prompt("Name of the saved state: ","Saved "+f);if(null===g)return;e[g]&&a.confirm("The name already exists. Overwrite?")&&(e[g]=0)}while(e[g]);h={type:b,inputs:{}};d.each(function(){var a=$(this);h.inputs[a.attr("name")]=
a.val()});e[g]=h;localStorage.setItem("magog.branchmapper.savestate",n(e))});$("#import").fileReader({error:b,load:function(){try{var d=0,e=this.result,f=c(localStorage.getItem("magog.branchmapper.savestate"));$.each(c(e),function(b,c){var e=c.inputs,g=!0;$.isPlainObject(e)&&($.each(e,function(a,b){return g="string"===typeof b}),g&&(e=f[b],e&&n(e)===n(c)&&a.confirm("Overwrite "+b+"?")||(d++,f[b]=c)))});localStorage.setItem("magog.branchmapper.savestate",n(f));a.alert(d+" entries loaded.")}catch(x){b()}}});
$("#export").click(function(){saveAs(new Blob([localStorage.getItem("magog.branchmapper.savestate")],{type:"text/plain;charset=utf-8"}),"branchmapper-data.txt")});y.click(function(a){return $jscomp.asyncExecutePromiseGeneratorFunction(function k(){return $jscomp.generator.createGenerator(k,function(b){switch(b.nextAddress){case 1:return a.preventDefault(),b.yield(p.slideToggle(50).promise(),2);case 2:y.text(p.is(":hidden")?"+":"-"),b.jumpToEnd()}})})})})(window); //# sourceMappingURL=js/branchmapper.js.map
